(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{188:function(t,e,n){var content=n(209);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(28).default)("b318e72e",content,!0,{sourceMap:!1})},189:function(t,e,n){var content=n(211);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(28).default)("265de43f",content,!0,{sourceMap:!1})},193:function(t,e,n){var content=n(281);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(28).default)("3016a465",content,!0,{sourceMap:!1})},194:function(t,e,n){var content=n(283);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(28).default)("01eca4d3",content,!0,{sourceMap:!1})},208:function(t,e,n){"use strict";var r=n(188);n.n(r).a},209:function(t,e,n){(t.exports=n(27)(!1)).push([t.i,".entry__duration{margin-left:1rem;float:right}.entry__group-count{color:#999;display:inline-block;width:2rem}.entry__second{margin-left:2.3rem}.entry__link{color:#4573b1;text-decoration:none;font-size:.9rem;margin-left:1rem}",""])},210:function(t,e,n){"use strict";var r=n(189);n.n(r).a},211:function(t,e,n){(t.exports=n(27)(!1)).push([t.i,"ons-list-header{z-index:20003}",""])},280:function(t,e,n){"use strict";var r=n(193);n.n(r).a},281:function(t,e,n){(t.exports=n(27)(!1)).push([t.i,".list-item__subtitle--success{color:#060}.list-item__subtitle--error{color:#600}",""])},282:function(t,e,n){"use strict";var r=n(194);n.n(r).a},283:function(t,e,n){(t.exports=n(27)(!1)).push([t.i,"ons-input:hover{background:#eee}ons-list-item[expandable]{padding:0}.expandable-button{padding-left:15px}",""])},284:function(t,e,n){"use strict";n.r(e);n(38),n(17),n(37);var r=n(5),o=n(72),c=(n(114),n(115),n(206),n(71),n(52),{props:{entry:{type:Object,required:!0}},data:function(){return{interval:!1,currentTickTime:0}},filters:{round:function(t){return Math.round(t)},replace:function(t,e,n){return t.replace(e,n)},rejoin:function(t,e){return t.split("\n").join(e)},brize:function(t,e,n){return t.replace("\n","<br>")}},computed:{duration:function(){if(this.entry.dur>0)return Math.round(this.entry.dur/1e3/60);if(0===this.entry.dur)return 0;var t=Math.round(this.entry.dur+this.currentTickTime/1e3),e={h:Math.floor(t/3600),m:Math.floor(t%3600/60),s:t%60};return e.m=e.m.toString().padStart(2,"0"),e.s=e.s.toString().padStart(2,"0"),"".concat(e.h,":").concat(e.m,":").concat(e.s)},taskUrl:function(){return"https://"+this.$store.state.config.PlanfixAccount+".planfix.ru/task/"+this.entry.planfix.task_id}},methods:{startTick:function(){var t=this;this.currentTickTime=(new Date).getTime(),this.interval=setInterval(function(){t.currentTickTime=(new Date).getTime()},1e3)},stopTick:function(){clearInterval(this.interval)}},created:function(){this.entry.dur<1&&(this.startTick(),"#current-go"==this.$route.hash&&this.entry.planfix.task_id>0&&(this.$route.hash,window.location.href=this.taskUrl))},beforeDestroy:function(){this.stopTick()}}),l=(n(208),n(14)),f={components:{Entry:Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-card",{staticClass:"entry"},[n("span",{staticClass:"entry__group-count"},[t._v(t._s(t.entry.planfix.group_count))]),t._v(" "),n("span",{staticClass:"entry__name"},[t._v(t._s(t._f("rejoin")(t.entry.description,", ")))]),t._v(" "),n("span",{staticClass:"entry__duration"},[t._v(t._s(t.duration))]),t._v(" "),n("div",{staticClass:"entry__second"},[n("span",{staticClass:"entry__project",style:"color:"+t.entry.project_hex_color},[t._v(t._s(t.entry.project))]),t._v(" "),t.entry.planfix.task_id?n("a",{staticClass:"entry__link",attrs:{href:t.taskUrl,target:"_blank"}},[t._v("\n      #"+t._s(t.entry.planfix.task_id)+"\n    ")]):t._e()])])},[],!1,null,null,null).exports},props:{entries:{type:Array,required:!0}}},d=Object(l.a)(f,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"entries"},this._l(this.entries,function(t){return e("div",{key:t.id},[e("Entry",{attrs:{entry:t}})],1)}),0)},[],!1,null,null,null).exports,m={components:{EntriesList:d},props:{entries:{type:Array,required:!0},label:{type:String,required:!1}}},h={props:["tabs"],components:{EntriesPage:Object(l.a)(m,function(){var t=this.$createElement,e=this._self._c||t;return e("v-ons-page",[e("v-ons-list-header",[this._v(this._s(this.label))]),this._v(" "),e("EntriesList",{attrs:{entries:this.entries}})],1)},[],!1,null,null,null).exports,EntriesList:d},computed:{index:{get:function(){return this.$store.state.tabIndex},set:function(t){this.$store.commit("tabIndex",t)}}}},v=(n(210),Object(l.a)(h,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-tabbar",{attrs:{position:"auto",swipeable:"",index:t.index,visible:!0},on:{"update:index":function(e){t.index=e}}},[n("template",{slot:"pages"},t._l(t.$store.state.tabs,function(t){return n("EntriesPage",{key:t.label,attrs:{entries:t.props.entries,label:t.label}})}),1),t._v(" "),t._l(t.$store.state.tabs,function(t){return n("v-ons-tab",{key:t.label,attrs:{label:t.label+" ("+t.props.entries.length+")"}})})],2)},[],!1,null,null,null).exports),y=(n(29),n(212)),_=n.n(y),x={props:["name","configName","type","min","max","action","buttonName","description"],data:function(){return{success:null,message:null,isSending:!1}},computed:{text:function(){return this.message||this.description}},methods:{checkAction:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(e){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.isSending=!0,t.next=3,this.$store.dispatch("storeConfig");case 3:return t.next=5,this.$axios.post(this.$store.state.apiUrl+"/config/reload");case 5:return t.next=7,this.action(e);case 7:n=t.sent,r=n.ok,o=n.message,this.isSending=!1,this.success=r,this.message=o,console.log(o);case 14:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),delayedStoreConfig:function(){var t,e=this,n=_.a,r=this;setTimeout(function(){t=JSON.parse(JSON.stringify(e.$store.state.config))},100),setTimeout(function(){var e=JSON.parse(JSON.stringify(r.$store.state.config));n(t,e)&&r.$store.dispatch("storeConfig")},2e3)}}},k=(n(280),Object(l.a)(x,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-list-item",[n("div",{staticClass:"center"},[n("span",{staticClass:"list-item__title",domProps:{innerHTML:t._s(t.name)}}),t._v(" "),n("span",{staticClass:"list-item__subtitle",class:{"list-item__subtitle--success":!0===t.success,"list-item__subtitle--error":!1===t.success},domProps:{innerHTML:t._s(t.text)}}),t._v(" "),["text","number","password"].includes(t.type)?n("v-ons-input",{staticStyle:{width:"100%"},attrs:{type:t.type},on:{input:t.delayedStoreConfig},model:{value:t.$store.state.config[t.configName],callback:function(e){t.$set(t.$store.state.config,t.configName,e)},expression:"$store.state.config[configName]"}}):t._e(),t._v(" "),"slider"==t.type?n("v-ons-range",{staticStyle:{width:"100%"},attrs:{min:t.min,max:t.max},on:{input:t.delayedStoreConfig},model:{value:t.$store.state.config[t.configName],callback:function(e){t.$set(t.$store.state.config,t.configName,e)},expression:"$store.state.config[configName]"}}):t._e()],1),t._v(" "),"switch"==t.type?n("div",{staticClass:"right"},[n("v-ons-switch",{on:{change:t.delayedStoreConfig},model:{value:t.$store.state.config[t.configName],callback:function(e){t.$set(t.$store.state.config,t.configName,e)},expression:"$store.state.config[configName]"}})],1):t._e(),t._v(" "),"check"==t.type?n("div",{staticClass:"right"},[n("v-ons-button",{attrs:{modifier:"outline",disabled:t.isSending},on:{click:t.checkAction}},[t._v(t._s(t.buttonName)+"\n    ")])],1):t._e()])},[],!1,null,null,null).exports),$={components:{PageToolbar:o.a,ConfigEntry:k},props:[],data:function(){var t=this;return{config:function(){return t.$store.state.config}}},watch:{config:function(t,e){console.log("config changed",t,e)}},methods:{checkPlanfixConnection:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){var e,n,data,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="",t.next=3,this.$axios.get(this.$store.state.apiUrl+"/validate/planfix/user");case 3:return n=t.sent,data=n.data,r=data.ok,o=data.errors,e=r?"Подключение успешно, "+data.data.Name+" "+data.data.LastName:"Подключение не удалось: "+o.join(", "),t.abrupt("return",{ok:r,message:e});case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),checkTogglConnection:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){var e,n,data,r,o,c,l,f,d,m,h=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="",t.next=3,this.$axios.get(this.$store.state.apiUrl+"/validate/toggl/user");case 3:if(n=t.sent,data=n.data,r=data.ok,o=data.errors,!r){t.next=19;break}return e="Подключение успешно",t.next=10,this.$axios.get(this.$store.state.apiUrl+"/toggl/workspaces");case 10:c=t.sent,l=c.data,f=l.data.map(function(t){return t.id+" ("+t.name+")"}),d="<br>Доступные workspaces:<br> "+f.join(",<br>"),0==(m=l.data.filter(function(t){return t.id==h.$store.state.config.TogglWorkspaceID})).length?(e="Подкючение удалось, но workspace id "+this.$store.state.config.TogglWorkspaceID+" не найден",r=!1):e="Подкючение удалось, иcпользуется "+m[0].name,e+=". "+d,t.next=20;break;case 19:e="Подключение не удалось: "+o.join(", ");case 20:return t.abrupt("return",{ok:r,message:e});case 21:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),checkPlanfixAnalitic:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){var e,n,data,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="",t.next=3,this.$axios.get(this.$store.state.apiUrl+"/validate/planfix/analitic");case 3:return n=t.sent,data=n.data,r=data.ok,o=data.errors,e=r?"Аналитика указана правильно":o.join(", "),t.abrupt("return",{ok:r,message:e});case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},C=(n(282),Object(l.a)($,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-list",[n("v-ons-list-item",[t._v("\n      Основные секции имеют кнопку проверки правильности настроек.\n      После изменения настроек перезапустите сервер, чтобы всё применилось\n    ")]),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"DryRun",type:"switch",description:"Тестовый режим, когда данные в Планфиксе и Toggl не меняются"}}),t._v(" "),n("v-ons-list-header",[t._v("Toggl")]),t._v(" "),n("div",[n("ConfigEntry",{attrs:{name:"","config-name":"TogglAPIToken",type:"password",description:"Токен Toggl, в <a target=_blank href=https://toggl.com/app/profile>настройках profile</a>"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"TogglWorkspaceID",type:"number",description:"Toggl workspace ID, в URL в <a target=_blank href=https://toggl.com/app/settings>веб-интерфейса Toggl</a>"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"",type:"check","button-name":"Проверить",action:t.checkTogglConnection}})],1),t._v(" "),n("v-ons-list-header",[t._v("Планфикс")]),t._v(" "),n("div",[n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAccount",type:"text",description:"Название вашего Планфикс аккаунта (mycompany для mycompany.planfix.ru"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixUserName",type:"text",description:"Логин вашего пользователя в Планфиксе"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"Пароль","config-name":"PlanfixUserPassword",type:"password",description:"Ваш пароль в Планфиксе"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAPIKey",type:"password",description:"Приватный API ключ, <br>попросите у владельца аккаунта, <a target=_blank href=https://planfix.ru/docs/ПланФикс_API:_Авторизация_по_токену>инструкция</a>"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAPIUrl",type:"text",description:"URL API Планфикса, <br>для аккаунтов в России он будет <a target=_blank href=https://planfix.ru/docs/Введение>другим</a>"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"",type:"check","button-name":"Проверить",action:t.checkPlanfixConnection}})],1),t._v(" "),n("v-ons-list-header",[t._v("Аналитика Планфикса: названия полей")]),t._v(" "),n("div",[n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAnaliticName",type:"text",description:"Название аналитики (не забудьте сохранить её перед проверкой), например, 'Выработка'"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAnaliticTypeName",type:"text",description:"Название поля выбора записи справочника, например, 'Вид работы'"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAnaliticTypeValue",type:"text",description:"Название записи справочника из предыдущего поля, измеряемой в минутах, например, 'Поминутная работа программиста'"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAnaliticCountName",type:"text",description:"Название поля количества, сюда будет попадать кол-во минут, например, 'Количество'"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAnaliticCommentName",type:"text",description:"Название поля комментария, сюда будет попадать название toggl записи"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAnaliticDateName",type:"text",description:"Название поля даты (день, без времени)"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"PlanfixAnaliticUsersName",type:"text",description:"Название поля сотрудника (мультиполе сотрудников)"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"",type:"check","button-name":"Проверить",action:t.checkPlanfixAnalitic}})],1),t._v(" "),n("v-ons-list-header",[t._v("Прочие настройки")]),t._v(" "),n("div",[n("ConfigEntry",{attrs:{name:"","config-name":"SendInterval",type:"slider",min:"0",max:"240",description:"Интервал отправки данных в Планфикс, мин: "+t.$store.state.config.SendInterval}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"CheckNewVersion",type:"switch",description:"Проверять доступность новой версии"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"Debug",type:"switch",description:"Подробный вывод ошибок (debug)"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"TogglSentTag",type:"text",description:"тег, который ставится отправленным toggl-записям"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"","config-name":"LogFile",type:"text",description:"путь к логу (относительно рабочей папки)"}})],1),t._v(" "),n("v-ons-list-header",[t._v("Старые настройки подключения через SMTP")]),t._v(" "),n("ons-list-item",{attrs:{expandable:""}},[n("div",{staticClass:"expandable-button"},[t._v("Если у вас бесплатный аккаунт")]),t._v(" "),n("div",{staticClass:"expandable-content"},[n("ConfigEntry",{attrs:{name:"Host","config-name":"SMTPHost",type:"text",description:""}}),t._v(" "),n("ConfigEntry",{attrs:{name:"Port","config-name":"SMTPPort",type:"number",description:""}}),t._v(" "),n("ConfigEntry",{attrs:{name:"Логин","config-name":"SMTPLogin",type:"text",description:""}}),t._v(" "),n("ConfigEntry",{attrs:{name:"Пароль","config-name":"SMTPPassword",type:"password",description:""}}),t._v(" "),n("ConfigEntry",{attrs:{name:"From","config-name":"SMTPEmailFrom",type:"text",description:"обычно совпадает с логином"}}),t._v(" "),n("ConfigEntry",{attrs:{name:"From","config-name":"PlanfixAuthorName",type:"text",description:"Имя Фамилия автора, будет приходить в письме для связи"}})],1)])],1)],1)},[],!1,null,null,null).exports),w={components:{EntriesTabsPage:v,SettingsPage:C,PageToolbar:o.a},computed:{},fetch:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.store,e.params,t.next=3,n.dispatch("fetchConfig");case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),asyncData:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(e){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.app,n=e.store,e.params,e.query,e.error,n.state.apiUrl,t.prev=2,r={},t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(2),console.log("error while get data"),Error(t.t0);case 10:return t.abrupt("return",r);case 11:case"end":return t.stop()}},t,null,[[2,6]])}));return function(e){return t.apply(this,arguments)}}(),data:function(){return{currentPage:"EntriesTabsPage",openSide:!1,entries:{}}},methods:{updateTabs:function(){var t=[{label:"Сейчас",props:{entries:this.entries.current}},{label:"Сегодня",props:{entries:this.entries.today}},{label:"Ожидают",props:{entries:this.entries.pending}},{label:"Неделя",props:{entries:this.entries.last}}];this.$store.commit("tabs",t)},updateData:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.entries=this.entries||{current:[],today:[],pending:[],last:[]},t.next=3,this.$axios.$get(this.$store.state.apiUrl+"/toggl/entries/current");case 3:return t.t0=t.sent,this.entries.current=[t.t0],t.next=7,this.$axios.$get(this.$store.state.apiUrl+"/toggl/entries",{params:{type:"today"}});case 7:return this.entries.today=t.sent,t.next=10,this.$axios.$get(this.$store.state.apiUrl+"/toggl/entries",{params:{type:"pending"}});case 10:return this.entries.pending=t.sent,t.next=13,this.$axios.$get(this.$store.state.apiUrl+"/toggl/entries",{params:{type:"last"}});case 13:this.entries.last=t.sent,0==this.entries.current[0].id&&(this.entries.current=[]),this.entries.today.sort(function(a,b){return b.id-a.id}),this.entries.pending.sort(function(a,b){return b.id-a.id}),this.entries.last.sort(function(a,b){return b.id-a.id}),this.updateTabs();case 19:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),setUpdateIntervals:function(t,e){var n=this;clearInterval(this.currentInterval),clearInterval(this.otherInterval),this.currentInterval=setInterval(Object(r.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$axios.$get(n.$store.state.apiUrl+"/toggl/entries/current");case 2:t.t0=t.sent,n.entries.current=[t.t0],n.updateTabs();case 5:case"end":return t.stop()}},t)})),t),this.otherInterval=setInterval(Object(r.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$axios.$get(n.$store.state.apiUrl+"/toggl/entries",{params:{type:"today"}});case 2:return n.entries.today=t.sent,t.next=5,n.$axios.$get(n.$store.state.apiUrl+"/toggl/entries",{params:{type:"pending"}});case 5:return n.entries.pending=t.sent,t.next=8,n.$axios.$get(n.$store.state.apiUrl+"/toggl/entries",{params:{type:"last"}});case 8:n.entries.last=t.sent,n.updateTabs();case 10:case"end":return t.stop()}},t)})),e)}},created:function(){this.pages=[{name:"Записи",page:v},{name:"Настройки",page:C}];this.$store.commit("tabs",[{label:"Сейчас",props:{entries:[]}},{label:"Сегодня",props:{entries:[]}},{label:"Ожидают",props:{entries:[]}},{label:"Неделя",props:{entries:[]}}]),this.updateData(),this.setUpdateIntervals(1e4,6e5)},mounted:function(){"#settings"==this.$route.hash&&(this.$route.hash,this.currentPage="SettingsPage")},onIdle:function(){this.setUpdateIntervals(3e5,18e5)},onActive:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.updateData(),this.setUpdateIntervals(1e4,6e5);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),head:function(){return this.entries.current?{title:"".concat(this.entries.current[0].description," - planfix-toggl")}:"planfix-toggl"}},E=Object(l.a)(w,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-ons-splitter",[n("v-ons-splitter-side",{attrs:{width:"150px",collapse:"",side:"right",open:t.$store.state.openSide},on:{"update:open":function(e){return t.$set(t.$store.state,"openSide",e)}}},[n("v-ons-page",[n("v-ons-list",t._l(t.pages,function(e){return n("v-ons-list-item",{key:e.name,attrs:{tappable:""},on:{click:function(n){t.currentPage=e.page,t.$store.state.openSide=!1,t.$store.state.title=e.name}}},[n("div",{staticClass:"center"},[t._v(t._s(e.name))])])}),1)],1)],1),t._v(" "),n("v-ons-splitter-content",[n(t.currentPage,{tag:"component"})],1)],1)],1)},[],!1,null,null,null);e.default=E.exports}}]);